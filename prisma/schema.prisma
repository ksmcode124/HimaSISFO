// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

// schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model kabinet {
  id_kabinet    Int              @id @default(autoincrement())
  nama_kabinet  String
  tahun_kerja   String
  gambar_logo   String?
  deskripsi     String?
  visi          String?
  misi          String?
  elemen_logo   elemen_logo[]
  departemen    departemen[]
  detailAnggota detail_anggota[]
  event         event[]
  proker        proker[]

  @@map("kabinet")
}

model elemen_logo {
  id_elemen_logo   Int     @id @default(autoincrement())
  nama_elemen      String
  deskripsi_elemen String?
  gambar_elemen    String?
  id_kabinet       Int
  kabinet          kabinet @relation(fields: [id_kabinet], references: [id_kabinet], onDelete: Cascade)

  @@map("elemen_logo")
}

model departemen {
  id_departemen        Int     @id @default(autoincrement())
  id_kabinet           Int
  nama_departemen      String
  deskripsi_departemen String?
  logo_departemen      String?

  kabinet       kabinet          @relation(fields: [id_kabinet], references: [id_kabinet], onDelete: Cascade)
  detailAnggota detail_anggota[]
  proker        proker[]
}

model anggota {
  id_anggota   Int    @id @default(autoincrement())
  nama_anggota String

  detailAnggota detail_anggota[]
}

model jabatan {
  id_jabatan   Int    @id @default(autoincrement())
  nama_jabatan String

  detailAnggota detail_anggota[]
}

model detail_anggota {
  id_detail     Int     @id @default(autoincrement())
  id_anggota    Int
  id_departemen Int
  id_kabinet    Int
  id_jabatan    Int
  foto_anggota  String?

  anggota    anggota    @relation(fields: [id_anggota], references: [id_anggota])
  departemen departemen @relation(fields: [id_departemen], references: [id_departemen])
  kabinet    kabinet    @relation(fields: [id_kabinet], references: [id_kabinet])
  jabatan    jabatan    @relation(fields: [id_jabatan], references: [id_jabatan])

  @@unique([id_anggota, id_kabinet])
}

model event {
  id_event         Int      @id @default(autoincrement())
  id_kabinet       Int
  judul            String
  deskripsi        String?
  tanggal_mulai    DateTime
  tanggal_berakhir DateTime
  gambar_event     String?
  kategori         String?

  kabinet kabinet @relation(fields: [id_kabinet], references: [id_kabinet], onDelete: Cascade)
}

model proker {
  id_proker     Int     @id @default(autoincrement())
  id_departemen Int
  id_kabinet    Int
  nama_proker   String
  deskripsi     String?
  foto_proker   String?

  departemen departemen @relation(fields: [id_departemen], references: [id_departemen])
  kabinet    kabinet    @relation(fields: [id_kabinet], references: [id_kabinet])
}

model user {
  id            String   @id @default(cuid())
  name          String?
  email         String   @unique
  emailVerified Boolean  @default(false)
  image         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  role          Role     @default(admin)

  accounts Account[]
  sessions Session[]
}

model Account {
  id                    String    @id @default(cuid())
  userId                String
  accountId             String
  providerId            String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  expiresAt             DateTime?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  type                  String    @default("credential") // âœ… Fix dari error sebelumnya

  user user @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([providerId, accountId])
}

model Session {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user user @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_token")
}

enum Role {
  superadmin
  admin
}
