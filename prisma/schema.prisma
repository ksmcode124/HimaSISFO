// schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/**
 * =========================
 * MASTER DATA (sesuai ERD)
 * =========================
 */

model kabinet {
  id_kabinet    Int      @id @default(autoincrement())
  nama_kabinet  String
  tahun_kerja   String
  visi          String?
  misi          String?
  deskripsi     String?
  foto_kabinet  String?  // di ERD tertulis integer, tapi untuk url/path paling aman String
  gambar_logo   String?

  elemen_logo   elemen_logo[]
  departemen    departemen[]
  detailAnggota detail_anggota[]
  event         event[]
  proker        proker[]
  komunitas     komunitas[]

  @@map("kabinet")
}

model elemen_logo {
  id_elemen_logo   Int     @id @default(autoincrement())
  id_kabinet       Int
  nama_elemen      String
  deskripsi_elemen String?
  gambar_elemen    String?

  kabinet kabinet @relation(fields: [id_kabinet], references: [id_kabinet], onDelete: Cascade)

  @@map("elemen_logo")
}

model departemen {
  id_departemen        Int     @id @default(autoincrement())
  id_kabinet           Int
  nama_departemen      String
  deskripsi_departemen String?
  logo_departemen      String?
  foto_departemen      String?

  kabinet       kabinet          @relation(fields: [id_kabinet], references: [id_kabinet], onDelete: Cascade)
  detailAnggota detail_anggota[]
  proker        proker[]

  @@map("departemen")
}

model anggota {
  id_anggota   Int    @id @default(autoincrement())
  nama_anggota String

  detailAnggota detail_anggota[]

  @@map("anggota")
}

model jabatan {
  id_jabatan   Int    @id @default(autoincrement())
  nama_jabatan String

  detailAnggota detail_anggota[]

  @@map("jabatan")
}

model detail_anggota {
  id_detail     Int     @id @default(autoincrement())
  id_anggota    Int
  id_jabatan    Int
  id_kabinet    Int
  id_departemen Int
  foto_anggota  String? // ERD: text

  anggota    anggota    @relation(fields: [id_anggota], references: [id_anggota], onDelete: Cascade)
  jabatan    jabatan    @relation(fields: [id_jabatan], references: [id_jabatan], onDelete: Cascade)
  kabinet    kabinet    @relation(fields: [id_kabinet], references: [id_kabinet], onDelete: Cascade)
  departemen departemen @relation(fields: [id_departemen], references: [id_departemen], onDelete: Cascade)

  @@unique([id_anggota, id_kabinet])
  @@map("detail_anggota")
}

model proker {
  id_proker     Int     @id @default(autoincrement())
  id_departemen Int
  id_kabinet    Int
  nama_proker   String
  deskripsi     String?
  foto_proker   String?

  departemen departemen @relation(fields: [id_departemen], references: [id_departemen], onDelete: Cascade)
  kabinet    kabinet    @relation(fields: [id_kabinet], references: [id_kabinet], onDelete: Cascade)

  @@map("proker")
}

model event {
  id_event         Int      @id @default(autoincrement())
  id_kabinet       Int
  judul            String
  deskripsi        String?
  tanggal_mulai    DateTime
  tanggal_berakhir DateTime
  gambar_event     String?
  kategori         String?

  kabinet kabinet @relation(fields: [id_kabinet], references: [id_kabinet], onDelete: Cascade)

  @@map("event")
}

/**
 * =========================
 * KOMUNITAS (sesuai ERD terbaru)
 * =========================
 */

model komunitas {
  id_komunitas   Int     @id @default(autoincrement())
  id_kabinet     Int
  foto_komunitas String? // ERD: text (bukan json)

  kabinet     kabinet               @relation(fields: [id_kabinet], references: [id_kabinet], onDelete: Cascade)
  pencapaian  komunitas_pencapaian[]

  @@map("komunitas")
}

model komunitas_pencapaian {
  id_pencapaian   Int     @id @default(autoincrement())
  id_komunitas    Int
  judul           String  // ERD: text (prisma tidak punya "text", pakai String)
  foto_pencapaian String? // ERD: text

  komunitas komunitas @relation(fields: [id_komunitas], references: [id_komunitas], onDelete: Cascade)

  @@map("komunitas_pencapaian")
}

/**
 * =========================
 * AUTH (biarkan seperti punyamu)
 * =========================
 */

model user {
  id            String   @id @default(cuid())
  name          String?
  email         String   @unique
  emailVerified Boolean  @default(false)
  image         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  role          Role     @default(admin)

  accounts Account[]
  sessions Session[]
}

model Account {
  id                    String    @id @default(cuid())
  userId                String
  accountId             String
  providerId            String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  expiresAt             DateTime?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  type                  String    @default("credential")

  user user @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([providerId, accountId])
}

model Session {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user user @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_token")
}

enum Role {
  superadmin
  admin
}
